<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>PeteZah | AI</title>
    <link rel="icon" type="icon/x-icon" href="/storage/images/logo-png-removebg-preview.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Funnel+Display:wght@300..800&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap");
      @import url("/storage/fonts/all.min.css");
      *{margin:0;padding:0;box-sizing:border-box;font-family:Inter,sans-serif}
      :root{
        --text-color:#ffffff;
        --subheading-color:#b3c0d9;
        --placeholder-color:#a0aecf;
        --primary-color:#1a2b44; /* Dark blue */
        --secondary-color:rgba(255, 255, 255, 0.1);
        --secondary-hover-color:rgba(255, 255, 255, 0.2);
        --scrollbar-color:rgba(255, 255, 255, 0.15)
      }
      body{color:var(--text-color);background:var(--primary-color)}
      .container{overflow-y:auto;padding:32px 0 60px;height:calc(100vh - 127px);scrollbar-color:var(--scrollbar-color) transparent}
      .container :where(.app-header,.suggestions,.message,.prompt-wrapper){position:relative;margin:0 auto;width:100%;padding:0 20px;max-width:990px}
      .container .app-header{margin-top:3vh}
      .container .suggestions{width:100%;list-style:none;display:flex;gap:15px;margin-top:9.5vh;overflow-x:auto;scroll-snap-type:x mandatory;scrollbar-width:none;position:absolute;bottom:100px;left:50%;transform:translateX(-50%)}
      body.chats-active .container :where(.app-header,.suggestions){display:none}
      .suggestions .suggestions-item{cursor:pointer;padding:18px;width:228px;flex-shrink:0;display:flex;scroll-snap-align:center;flex-direction:column;align-items:flex-end;border-radius:15px;justify-content:space-between;background:var(--secondary-color);transition:.1s}
      .suggestions .suggestions-item:hover{background:var(--secondary-hover-color)}
      .suggestions .suggestions-item .text{font-size:1.1rem}
      .suggestions .suggestions-item .icon{width:45px;height:45px;display:flex;font-size:1.1rem;margin-top:35px;align-self:flex-end;align-items:center;border-radius:25%;justify-content:center;color:#4d8cff;background:var(--primary-color)}
      .suggestions .suggestions-item:nth-child(2) .icon{color:#fff176}
      .suggestions .suggestions-item:nth-child(3) .icon{color:#66bb6a}
      .suggestions .suggestions-item:nth-child(4) .icon{color:#9575cd}
      .container .chats-container{display:flex;gap:20px;flex-direction:column}
      .chats-container .message{display:flex;gap:11px;align-items:center}
      .chats-container .message .avatar{width:43px;height:43px;flex-shrink:0;align-self:flex-start;border-radius:50%;padding:6px;margin-right:-7px;background:var(--secondary-color);border:1px solid var(--secondary-hover-color)}
      .chats-container .message.loading .avatar{animation:3s linear infinite rotate}
      @keyframes rotate{100%{transform:rotate(360deg)}}
      .chats-container .message .message-text{padding:3px 16px;word-wrap:break-word;white-space:pre-line}
      .chats-container .bot-message{margin:9px auto;position:relative}
      .chats-container .user-message{flex-direction:column;align-items:flex-end}
      .chats-container .user-message .message-text{padding:12px 16px;max-width:75%;background:var(--secondary-color);border-radius:10px}
      .chats-container .user-message .img-attachment{margin-top:-7px;width:50%;border-radius:15px}
      .chats-container .user-message .file-attachment{display:flex;gap:6px;align-items:center;padding:10px;margin-top:-7px;border-radius:10px;background:var(--secondary-color)}
      .chats-container .user-message .file-attachment span,.prompt-wrapper .prompt-form .file-icon{color:#4d8cff}
      .container .prompt-container{position:fixed;width:100%;left:0;bottom:0;padding:16px 0;background:var(--primary-color)}
      .prompt-container :where(.prompt-wrapper,.prompt-form,.prompt-actions){display:flex;gap:12px;height:56px;align-items:center}
      .prompt-container .prompt-form{height:100%;width:100%;border-radius:15px;background:var(--secondary-color)}
      .prompt-form .prompt-input{width:100%;height:100%;background:0 0;outline:0;border:none;font-size:1rem;color:var(--text-color);padding-left:24px}
      .prompt-form .prompt-input::placeholder{color:var(--placeholder-color)}
      .prompt-wrapper button{width:56px;height:100%;flex-shrink:0;cursor:pointer;border-radius:12px;font-size:1.1rem;border:none;color:var(--text-color);background:var(--secondary-color);transition:.1s}
      .prompt-wrapper :is(button:hover,#cancel-file-btn,.file-icon){background:var(--secondary-hover-color)}
      .prompt-form .prompt-actions{gap:5px;margin-right:7px}
      .prompt-wrapper .prompt-form :where(.file-upload-wrapper,button,img){position:relative;height:45px;width:45px}
 .prompt-form .prompt-actions #send-prompt-btn{color:#fff;display:none;background:#4d8cff}
      .prompt-form .prompt-input:valid~.prompt-actions #send-prompt-btn{display:block}
      .prompt-form #send-prompt-btn:hover{background:#6699ff}
      .prompt-form .file-upload-wrapper :where(button,img){display:none;border-radius:12px;object-fit:cover;position:absolute}
      .prompt-form #stop-response-btn,.prompt-form .file-upload-wrapper.active #add-file-btn,body.bot-responding .prompt-form .file-upload-wrapper{display:none}
      .prompt-form .file-upload-wrapper #add-file-btn,.prompt-form .file-upload-wrapper.active.file-attached .file-icon,.prompt-form .file-upload-wrapper.active.img-attached img,.prompt-form .file-upload-wrapper.active:hover #cancel-file-btn,body.bot-responding .prompt-form #stop-response-btn{display:block}
      .prompt-form :is(#stop-response-btn:hover,#cancel-file-btn){color:#ef5350}
      .copy-button {margin-top: 8px;padding: 6px 12px;background: var(--secondary-color);color: var(--text-color);border: none;border-radius: 8px;cursor: pointer;transition: .1s;font-size: 0.9rem}
      .copy-button:hover {background: var(--secondary-hover-color)}
      @media (max-width:768px){
        .container{padding:20px 0 100px}
        .app-header :is(.heading,.sub-heading){font-size:2rem;line-height:1.4}
        .app-header .sub-heading{font-size:1.7rem}
        .container .chats-container{gap:15px}
        .chats-container .bot-message{margin:4px auto}
        .prompt-container :where(.prompt-wrapper,.prompt-form,.prompt-actions){gap:8px;height:53px}
        .prompt-container button{width:53px}
        .prompt-form :is(.file-upload-wrapper,button,img){height:42px;width:42px}
        .prompt-form .prompt-input{padding-left:20px}
        .prompt-form .file-upload-wrapper.active #cancel-file-btn{opacity:0}
        .prompt-wrapper.hide-controls :where(#theme-toggle-btn,#delete-chats-btn){display:none}
      }
    </style>
  </head>

  <body>
    <div class="container">
      <ul class="suggestions">
        <li class="suggestions-item">
          <p class="text">Write me an essay on dogs.</p>
          <span class="icon"><i class="fa-regular fa-pencil"></i></span>
        </li>
        <li class="suggestions-item">
          <p class="text">Suggest a creative project idea.</p>
          <span class="icon"><i class="fa-regular fa-lightbulb"></i></span>
        </li>
        <li class="suggestions-item">
          <p class="text">Help me plan a weekend getaway.</p>
          <span class="icon"><i class="fa-regular fa-map-signs"></i></span>
        </li>
        <li class="suggestions-item">
          <p class="text">Write a simple to-do app in Python.</p>
          <span class="icon"><i class="fa-regular fa-code"></i></span>
        </li>
      </ul>
      <div class="chats-container"></div>
      <div class="prompt-container">
        <div class="prompt-wrapper">
          <form action="#" class="prompt-form">
            <input
              type="text"
              placeholder="Ask anything..."
              class="prompt-input"
              required
            />
            <div class="prompt-actions">
              <div class="file-upload-wrapper">
                <img src="#" class="file-preview" />
                <input
                  id="file-input"
                  type="file"
                  accept="image/*, .pdf, .txt, .csv"
                  hidden
                />
                <button type="button">
                  <i class="fa-regular fa-arrow-right"></i>
                </button>
                <button id="cancel-file-btn" type="button">
                  <i class="fa-regular fa-paperclip"></i>
                </button>
                <button id="add-file-btn" type="button">
                  <i class="fa-regular fa-paperclip"></i>
                </button>
              </div>
              <button id="stop-response-btn" type="button">
                <i class="fa-regular fa-square"></i>
              </button>
              <button id="send-prompt-btn">
                <i class="fa-regular fa-arrow-right"></i>
              </button>
            </div>
          </form>
          <button id="delete-chats-btn">
            <i class="fa-regular fa-trash"></i>
          </button>
        </div>
      </div>
    </div>
    <script>
      const PeteAIKey = "AIzaSyC-t9UqpXINmssoIb8vNiMMU8ZOYss7cKY";
    </script>
    <script>
      const container=document.querySelector(".container"),
            chatsContainer=document.querySelector(".chats-container"),
            promptForm=document.querySelector(".prompt-form"),
            promptInput=promptForm.querySelector(".prompt-input"),
            fileInput=promptForm.querySelector("#file-input"),
            fileUploadWrapper=promptForm.querySelector(".file-upload-wrapper"),
            API_URL=`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${PeteAIKey}`;
      let controller, typingInterval;
      const chatHistory=[], userData={message:"",file:{}};

      const createMessageElement=(e,...t)=>{
        const a=document.createElement("div");
        a.classList.add("message",...t);
        a.innerHTML=e;
        return a;
      };

      const scrollToBottom=()=>container.scrollTo({top:container.scrollHeight,behavior:"smooth"});

      const typingEffect=(e,t,a)=>{
        t.textContent="";
        const s=e.split(" ");
        let o=0;
        typingInterval=setInterval(()=>{
          if(o<s.length){
            t.textContent+=(o===0?"":" ")+s[o++];
            scrollToBottom();
          }else{
            clearInterval(typingInterval);
            a.classList.remove("loading");
            document.body.classList.remove("bot-responding");
            addCopyButton(a, e);
          }
        },20);
      };

      const addCopyButton=(messageElement, text)=>{
        if(messageElement.classList.contains("bot-message")){
          const copyBtn=document.createElement("button");
          copyBtn.className="copy-button";
          copyBtn.textContent="Copy";
          copyBtn.onclick=()=>{
            navigator.clipboard.writeText(text).then(()=>{
              copyBtn.textContent="Copied!";
              setTimeout(()=>copyBtn.textContent="Copy",1000);
            });
          };
          messageElement.appendChild(copyBtn);
        }
      };

      const generateResponse=async e=>{
        const t=e.querySelector(".message-text");
        controller=new AbortController;
        chatHistory.push({role:"user",parts:[{text:userData.message},...userData.file.data?[{inline_data:(({fileName:e,isImage:t,...a})=>a)(userData.file)}]:[]]});
        try{
          const a=await fetch(API_URL,{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({contents:chatHistory}),
            signal:controller.signal
          });
          const s=await a.json();
          if(!a.ok)throw new Error(s.error.message);
          const o=s.candidates[0].content.parts[0].text.replace(/\*\*([^*]+)\*\*/g,"$1").trim();
          typingEffect(o,t,e);
          chatHistory.push({role:"model",parts:[{text:o}]});
        }catch(a){
          t.textContent="AbortError"===a.name?"Response generation stopped.":a.message;
          t.style.color="#ef5350";
          e.classList.remove("loading");
          document.body.classList.remove("bot-responding");
          scrollToBottom();
          addCopyButton(e, t.textContent);
        }finally{
          userData.file={};
        }
      };

      const handleFormSubmit=e=>{
        e.preventDefault();
        const t=promptInput.value.trim();
        if(!t||document.body.classList.contains("bot-responding"))return;
        userData.message=t;
        promptInput.value="";
        document.body.classList.add("chats-active","bot-responding");
        fileUploadWrapper.classList.remove("file-attached","img-attached","active");
        const a=`\n    <p class="message-text"></p>\n    ${userData.file.data?userData.file.isImage?`<img src="data:${userData.file.mime_type};base64,${userData.file.data}" class="img-attachment" />`:`<p class="file-attachment"><span class="material-symbols-rounded">description</span>${userData.file.fileName}</p>`:""}\n  `;
        const s=createMessageElement(a,"user-message");
        s.querySelector(".message-text").textContent=userData.message;
        chatsContainer.appendChild(s);
        scrollToBottom();
        setTimeout(()=>{
          const e=createMessageElement('<p class="message-text">...</p>',"bot-message","loading");
          chatsContainer.appendChild(e);
          scrollToBottom();
          generateResponse(e);
        },600);
      };

      fileInput.addEventListener("change",(()=>{
        const e=fileInput.files[0];
        if(!e)return;
        const t=e.type.startsWith("image/");
        const a=new FileReader;
        a.readAsDataURL(e);
        a.onload=a=>{
          fileInput.value="";
          const s=a.target.result.split(",")[1];
          fileUploadWrapper.querySelector(".file-preview").src=a.target.result;
          fileUploadWrapper.classList.add("active",t?"img-attached":"file-attached");
          userData.file={fileName:e.name,data:s,mime_type:e.type,isImage:t};
        };
      }));

      document.querySelector("#cancel-file-btn").addEventListener("click",(()=>{
        userData.file={};
        fileUploadWrapper.classList.remove("file-attached","img-attached","active");
      }));

      document.querySelector("#stop-response-btn").addEventListener("click",(()=>{
        controller?.abort();
        userData.file={};
        clearInterval(typingInterval);
        chatsContainer.querySelector(".bot-message.loading").classList.remove("loading");
        document.body.classList.remove("bot-responding");
      }));

      document.querySelector("#delete-chats-btn").addEventListener("click",(()=>{
        chatHistory.length=0;
        chatsContainer.innerHTML="";
        document.body.classList.remove("chats-active","bot-responding");
      }));

      document.querySelectorAll(".suggestions-item").forEach(e=>{
        e.addEventListener("click",()=>{
          promptInput.value=e.querySelector(".text").textContent;
          promptForm.dispatchEvent(new Event("submit"));
        });
      });

      document.addEventListener("click",({target:e})=>{
        const t=document.querySelector(".prompt-wrapper");
        const a=e.classList.contains("prompt-input")||t.classList.contains("hide-controls")&&("add-file-btn"===e.id||"stop-response-btn"===e.id);
        t.classList.toggle("hide-controls",a);
      });

      promptForm.addEventListener("submit",handleFormSubmit);
      promptForm.querySelector("#add-file-btn").addEventListener("click",()=>fileInput.click());
    </script>
  </body>
</html>
